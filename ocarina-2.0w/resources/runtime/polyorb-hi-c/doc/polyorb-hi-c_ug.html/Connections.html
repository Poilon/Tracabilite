<html lang="en">
<head>
<title>Connections - PolyORB-HI-C User's Guide</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="PolyORB-HI-C User's Guide">
<meta name="generator" content="makeinfo 4.8">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="AADL-to-C-transformations.html#AADL-to-C-transformations" title="AADL to C transformations">
<link rel="prev" href="Threads.html#Threads" title="Threads">
<link rel="next" href="Subprograms.html#Subprograms" title="Subprograms">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
Copyright (C) 2007-2009, E'cole nationale supe'rieure des
te'lc'ommunications

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.1 or
any later version published by the Free Software Foundation; with the
Invariant Sections being ``GNU Free Documentation License'', with the
Front-Cover Texts being ``PolyORB High Integrity C User's Guide'', and
with no Back-Cover Texts.  A copy of the license is included in the
section entitled ``GNU Free Documentation License''.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
body {}
body {
	background-color: white;
	position: absolute;
	font-size: medium;
	font-family: Verdana;
//	padding-left: 7em;
	top: 3em;
}

div.navigation {
	font-size: small; 
	padding-left: 0; 
	padding-right: 0; 
	text-align: right
}

div#menu {
	text-align: left;
	position: fixed;
	left: 1pt;
	bottom: auto;
	top: 2em;
	right: auto;
	padding-right: 1ex;
	padding-left: 1em;
	padding-top: 1ex;
	padding-bottom: 1ex;
	border-width: 3pt;
	background-color: transparent;  
	border-color: red; 
	border-left-style: solid
}

div#menu span.item {
	display: block;
	background-color: transparent;  
}

table.navigation {
	font-size: small
} 


/* Paragraphs */
p, blockquote {
	color: black; 
	text-indent: 1em; 
	text-align: justify
}


p {
	margin-bottom: .5em; 
	margin-top: 1px
}

p kbd 
{
  background-color: ivory
}

div.important {
	background-color: lightgray; 
	border-color: red; 
	border-style: solid;  
	border-width: 1pt
}
p.important {
	color: red
}
p.brut {
	text-indent: 0
}
p.brut:first-letter {
	font-size: 100%; 
	font-weight: normal
}

/* Sections */
div {
	border-style: none; 
	padding-left: 1em; 
	padding-right: 1em; 
	margin-top: 2px; 
	margin-bottom: 2px
}


/* Menus */

div.action {
	background-color: ivory; 
	border-color: lightgray; 
	border-style: solid; 
	border-width: 1pt 1pt 1pt 1pt; 
	font-size: small; 
	text-align: left
}

div.special 
{
  border-color: lightgray; 
  border-style: solid; 
  border-width: 0 0 0 4pt
}


/* Docbook special settings */

h3.subtitle {
	text-align: center
}

h1.title {
	margin-bottom: 10pt;
}

div.authorgroup {
	margin-top: 2em;
	margin-bottom: 2em;
	text-align: center;
	display: block;
}

div.author {
	display: inline;
}

h3.author {
	display: inline;
	font-style: normal;
	color: black;
	font-size: medium;
}

p.copyright {
	margin-top: 1em;
	text-align: center;
}

/* End docbook settings */


/* hors-texte */

pre {
	background-color: whitesmoke;
	border-color: lightcoral;
	border-style: solid;
	border-width: 0pt 1pt 1pt 0pt;
}

.hors-texte {
	background-color: lightgray;  
	border-color: lightcoral; 
	border-style: solid;
	border-width: 1pt; 
	padding-left: 1em; 	
	padding-right: 1em; 
	text-align: justify
}

/* Tables */

table.hors-texte {
	margin: auto; 
	font-size: 100%;
	border-width: 1pt 1pt 1pt 1pt
}

table.hors-texte td {
	padding-left: 1ex; 
	padding-right: 1ex
}

table.hors-texte tr.sep {
	padding-top: 1ex
}


h1, h2, h3, h4, h5, h6 
{
  color: black; 
  text-decoration: none; 
  font-weight: bold;
  padding: 0pt
}

h1 {
	font-size: larger larger larger;
	text-align: center; 
	margin-bottom: 24pt
}
h2 {
	font-size: larger larger;
	margin-left:      0; 
	margin-top:       24pt; 
	margin-bottom:    14pt;
	border-color:     red;
	border-bottom-style:     solid;
	border-width:     1pt;
	padding:          2pt; 
	margin-left:      0; 
	margin-right:     0; 
}
h3 {
	font-size: larger;
	margin-left: 1em; 
	margin-bottom: 1ex;
	color: red;	
}
h4, h5, h6 {
	font-size: normal;
	margin-left: 2em; 
	margin-bottom: 1em
}

h4 {
	text-decoration: underlined
}
h5 {
	font-style: italic
}


h2.special 
{
  border-style:     solid;
  border-width:	    1pt;
  border-color:     lightgray;
  padding:          2pt; 
}

img.flottant {
	float: right;
	clear: both;
	margin: 2em;
}

/* Lists */

li, dd 
{
  text-align: justify
}

dt {
	font-style: normal; 
	margin-top: 1em
}
dd {
	font-style: normal; 
	margin-left: 4em
}

dd.sdd {
	margin-left: 5em
}

dd ul {margin-top: 0}
li dl {margin-top: 0}
ul {list-style-type: square}
ul ul {list-style-type: disc}
ul ul ul {list-style-type: circle}

/* Addresses */

address {
	margin-top: 1ex; margin-bottom: 1ex
}
address.poste {
	font-style: italic
}
address.email {
	font-style: normal
}
address.phone {
	font-style: oblic
}

/* Links */

a:link, a:visited {
	color: darkred;
	text-decoration: none;
	border-bottom-width: 1px;
	border-bottom-style: dotted;
	border-bottom-color:  red;
	padding-bottom: 0px
}

a:hover, a:active {
	color: red; 
	text-decoration: none;
	border-bottom-color: black;
	border-bottom-style: solid
}

--></style>
</head>
<body>
<div class="node">
<p>
<a name="Connections"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="Subprograms.html#Subprograms">Subprograms</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Threads.html#Threads">Threads</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="AADL-to-C-transformations.html#AADL-to-C-transformations">AADL to C transformations</a>
<hr>
</div>

<h3 class="section">B.5 Connections</h3>

<!--  -->
<p>The connections are entities that support communication between the
application nodes. In this section, we present the AADL entities used
to model connection between nodes. There is no implicit mapping rules
for AADL connections, they just help to know the data flow (in case of
data connections) and some aspects of the control flow (event
connections) in the distributed application. In this section, we will talk about
how data are sended (marshall functions) and which functions are used to send
and receive data.

<h4 class="subsection">B.5.1 AADL entities</h4>

<p>As said in <a href="Distributed-application-nodes.html#Distributed-application-nodes">Distributed application nodes</a> and <a href="Whole-distributed-application.html#Whole-distributed-application">Whole distributed application</a> a connection between two nodes of the
distributed application is modeled by:
     <ul>
  <li>The <code>ports</code> features that exist on each one of the
  nodes. Ports can be declared inside processes or threads. The
  direction of the port (<code>in</code>, <code>out</code> or <code>in
  out</code>) indicates the direction of the information flow.

     <li>The <code>connections</code> section in the system implementation
  relative to the distributed application and in the process and
  thread implementations. 
</ul>

<pre class="smallexample">     
     <b>system</b> PING
     <b>end</b> PING;
     
     <b>system</b> <b>implementation</b> PING.Impl
     <b>subcomponents</b>
       -- <i> Nodes</i>
       Node_A : <b>process</b> A.Impl;
       Node_B : <b>process</b> B.Impl {ARAO::port_number =&gt; 12002;};
     
       -- <i> Processors</i>
       CPU_A  : <b>process</b>or the_processor;
       CPU_B  : <b>process</b>or the_processor;
     <b>connections</b>
       -- <i> Port connections</i>
       <b>event</b> <b>data</b> <b>port</b> Node_A.Out_Port -&gt; Node_B.In_Port;
     <b>properties</b>
       -- <i> Processor bindings</i>
       actual_processor_binding =&gt; <b>reference</b> CPU_A <b>applies</b> <b>to</b> Node_A;
       actual_processor_binding =&gt; <b>reference</b> CPU_B <b>applies</b> <b>to</b> Node_B;
     <b>end</b> PING.Impl;
     
</pre>
   <p>The listing above shows the connection between the node <code>A</code> and
<code>B</code> in the system implementation.

   <p>The nature of the <code>port</code> (<i>event port</i>, <i>data
port</i> or <i>event data port</i>) depends on the nature of the
connection between the two nodes:
     <ul>
 <li>if the message sent from one node to another node is only a
 triggering event and contains no data, we create an <i>event</i>
 port.

     <li>if the message sent from one node to another node is a data
 message but it does not trigger the receiver thread, we create a
 <i>data</i> port.

     <li>if the message sent from one node to another node is a data
 message that triggers the receiver thread, we create an <i>event
 data</i> port. 
</ul>

<h4 class="subsection">B.5.2 Marshallers</h4>

<p>In a distributed system, when we send any data to a node, we need to put them in
a stream. We call that the marshall operation. On the other hand, find
data in a stream is called the unmarshall operation. In each distributed
application, we generate marshallers for each types and request. These functions
will marshall/unmarshall data in/from a message.

   <p>All marshallers functions are generated in a file called <samp><span class="file">marshallers.c</span></samp>. 
The marshall (or unmarshall) functions for request are prefixed by the string
<code>__po_hi_marshall_request_</code> (or <code>__po_hi_unmarshall_request_</code>). Marshall
(or unmarshall) functions for types are prefixed by the string
<code>__po_hi_marshall_type_</code> (or <code>__po_hi_unmarshall_type_</code>). Each function
has the name of the type or the request it marshalls.

   <p>Finally, a function <code>__po_hi_marshall_request</code> and
<code>__po_hi_unmarshall_request</code> is generated to handle all requests. Then, is
called the appropriate function to call to marshall or unmarshall the data.

<pre class="smallexample">     
     #include &lt;types.h&gt;
     #include &lt;po_hi_types.h&gt;
     #include &lt;po_hi_marshallers.h&gt;
     
     /***************************************/
     /* __po_hi_marshall_type_simple_type   */
     /***************************************/
     
     <b>void</b> __po_hi_marshall_type_simple_type
           (simple_type value,
           __po_hi_msg_t* message,
           __po_hi_uint16_t* offset)
     {
     
        __po_hi_marshall_int(value,message,offset);
     }
     
     
     /*****************************************/
     /* __po_hi_unmarshall_type_simple_type   */
     /*****************************************/
     
     <b>void</b> __po_hi_unmarshall_type_simple_type
           (simple_type* value,
           __po_hi_msg_t* message,
           __po_hi_uint16_t* offset)
     {
     
        __po_hi_unmarshall_int(value,message,offset);
     }
     
     
     /************************************************/
     /* __po_hi_marshall_request_ping_me_data_sink   */
     /************************************************/
     
     <b>void</b> __po_hi_marshall_request_ping_me_data_sink
           (__po_hi_request_t* request,
           __po_hi_msg_t* message,
           __po_hi_uint16_t* offset)
     {
     
        __po_hi_marshall_type_simple_type(request-&gt;vars.ping_me_global_data_sink.ping_me_global_data_sink,message,offset);
     }
     
     
     /**************************************************/
     /* __po_hi_unmarshall_request_ping_me_data_sink   */
     /**************************************************/
     
     <b>void</b> __po_hi_unmarshall_request_ping_me_data_sink
           (__po_hi_request_t* request,
           __po_hi_msg_t* message,
           __po_hi_uint16_t* offset)
     {
     
        __po_hi_unmarshall_type_simple_type(&amp;(request-&gt;vars.ping_me_global_data_sink.ping_me_global_data_sink),message,offset);
     }
     
     
     /*************************************************/
     /* __po_hi_marshall_request_pinger_data_source   */
     /*************************************************/
     
     <b>void</b> __po_hi_marshall_request_pinger_data_source
           (__po_hi_request_t* request,
           __po_hi_msg_t* message,
           __po_hi_uint16_t* offset)
     {
     
        __po_hi_marshall_type_simple_type(request-&gt;vars.pinger_global_data_source.pinger_global_data_source,message,offset);
     }
     
     
     /***************************************************/
     /* __po_hi_unmarshall_request_pinger_data_source   */
     /***************************************************/
     
     <b>void</b> __po_hi_unmarshall_request_pinger_data_source
           (__po_hi_request_t* request,
           __po_hi_msg_t* message,
           __po_hi_uint16_t* offset)
     {
     
        __po_hi_unmarshall_type_simple_type(&amp;(request-&gt;vars.pinger_global_data_source.pinger_global_data_source),message,offset);
     }
     
     
     /******************************/
     /* __po_hi_marshall_request   */
     /******************************/
     
     <b>void</b> __po_hi_marshall_request
           (__po_hi_request_t* request,
           __po_hi_msg_t* message)
     {
        __po_hi_uint16_t offset;
     
        offset = 0;
        __po_hi_marshall_port(request-&gt;port,message);
        <b>switch</b> (request-&gt;port)
        {
           <b>case</b> ping_me_global_data_sink:
           {
              __po_hi_marshall_request_ping_me_data_sink(request,message,&amp;(offset));
     
              break;
           }
           <b>case</b> pinger_global_data_source:
           {
              __po_hi_marshall_request_pinger_data_source(request,message,&amp;(offset));
     
              break;
           }
           default:
           {
              break;
           }
        }
     }
     
     
     /********************************/
     /* __po_hi_unmarshall_request   */
     /********************************/
     
     <b>void</b> __po_hi_unmarshall_request
           (__po_hi_request_t* request,
           __po_hi_msg_t* message)
     {
        __po_hi_uint16_t offset;
     
        offset = 0;
        __po_hi_unmarshall_port(&amp;(request-&gt;port),message);
        <b>switch</b> (request-&gt;port)
        {
           <b>case</b> ping_me_global_data_sink:
           {
              __po_hi_unmarshall_request_ping_me_data_sink(request,message,&amp;(offset));
     
              break;
           }
           <b>case</b> pinger_global_data_source:
           {
              __po_hi_unmarshall_request_pinger_data_source(request,message,&amp;(offset));
     
              break;
           }
           default:
           {
              break;
           }
        }
     }
     
     
     
</pre>
   <!--  -->
</body></html>

