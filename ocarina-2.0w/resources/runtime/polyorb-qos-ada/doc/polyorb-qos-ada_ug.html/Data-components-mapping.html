<html lang="en">
<head>
<title>Data components mapping - PolyORB AADL personality User's Guide</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="description" content="PolyORB AADL personality User's Guide">
<meta name="generator" content="makeinfo 4.8">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Components-mapping-rules.html#Components-mapping-rules" title="Components mapping rules">
<link rel="next" href="Subprogram-components-mapping.html#Subprogram-components-mapping" title="Subprogram components mapping">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
Copyright (C) 2003-2009 E'cole
nationale supe'rieure des te'le'communications

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.1 or
any later version published by the Free Software Foundation; with the
Invariant Sections being ``GNU Free Documentation License'', with the
Front-Cover Texts being ``PolyORB High Integrity User's Guide'', and
with no Back-Cover Texts.  A copy of the license is included in the
section entitled ``GNU Free Documentation License''.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
body {}
body {
	background-color: white;
	position: absolute;
	font-size: medium;
	font-family: Verdana;
//	padding-left: 7em;
	top: 3em;
}

div.navigation {
	font-size: small; 
	padding-left: 0; 
	padding-right: 0; 
	text-align: right
}

div#menu {
	text-align: left;
	position: fixed;
	left: 1pt;
	bottom: auto;
	top: 2em;
	right: auto;
	padding-right: 1ex;
	padding-left: 1em;
	padding-top: 1ex;
	padding-bottom: 1ex;
	border-width: 3pt;
	background-color: transparent;  
	border-color: red; 
	border-left-style: solid
}

div#menu span.item {
	display: block;
	background-color: transparent;  
}

table.navigation {
	font-size: small
} 


/* Paragraphs */
p, blockquote {
	color: black; 
	text-indent: 1em; 
	text-align: justify
}


p {
	margin-bottom: .5em; 
	margin-top: 1px
}

p kbd 
{
  background-color: ivory
}

div.important {
	background-color: lightgray; 
	border-color: red; 
	border-style: solid;  
	border-width: 1pt
}
p.important {
	color: red
}
p.brut {
	text-indent: 0
}
p.brut:first-letter {
	font-size: 100%; 
	font-weight: normal
}

/* Sections */
div {
	border-style: none; 
	padding-left: 1em; 
	padding-right: 1em; 
	margin-top: 2px; 
	margin-bottom: 2px
}


/* Menus */

div.action {
	background-color: ivory; 
	border-color: lightgray; 
	border-style: solid; 
	border-width: 1pt 1pt 1pt 1pt; 
	font-size: small; 
	text-align: left
}

div.special 
{
  border-color: lightgray; 
  border-style: solid; 
  border-width: 0 0 0 4pt
}


/* Docbook special settings */

h3.subtitle {
	text-align: center
}

h1.title {
	margin-bottom: 10pt;
}

div.authorgroup {
	margin-top: 2em;
	margin-bottom: 2em;
	text-align: center;
	display: block;
}

div.author {
	display: inline;
}

h3.author {
	display: inline;
	font-style: normal;
	color: black;
	font-size: medium;
}

p.copyright {
	margin-top: 1em;
	text-align: center;
}

/* End docbook settings */


/* hors-texte */

pre {
	background-color: whitesmoke;
	border-color: lightcoral;
	border-style: solid;
	border-width: 0pt 1pt 1pt 0pt;
}

.hors-texte {
	background-color: lightgray;  
	border-color: lightcoral; 
	border-style: solid;
	border-width: 1pt; 
	padding-left: 1em; 	
	padding-right: 1em; 
	text-align: justify
}

/* Tables */

table.hors-texte {
	margin: auto; 
	font-size: 100%;
	border-width: 1pt 1pt 1pt 1pt
}

table.hors-texte td {
	padding-left: 1ex; 
	padding-right: 1ex
}

table.hors-texte tr.sep {
	padding-top: 1ex
}


h1, h2, h3, h4, h5, h6 
{
  color: black; 
  text-decoration: none; 
  font-weight: bold;
  padding: 0pt
}

h1 {
	font-size: larger larger larger;
	text-align: center; 
	margin-bottom: 24pt
}
h2 {
	font-size: larger larger;
	margin-left:      0; 
	margin-top:       24pt; 
	margin-bottom:    14pt;
	border-color:     red;
	border-bottom-style:     solid;
	border-width:     1pt;
	padding:          2pt; 
	margin-left:      0; 
	margin-right:     0; 
}
h3 {
	font-size: larger;
	margin-left: 1em; 
	margin-bottom: 1ex;
	color: red;	
}
h4, h5, h6 {
	font-size: normal;
	margin-left: 2em; 
	margin-bottom: 1em
}

h4 {
	text-decoration: underlined
}
h5 {
	font-style: italic
}


h2.special 
{
  border-style:     solid;
  border-width:	    1pt;
  border-color:     lightgray;
  padding:          2pt; 
}

img.flottant {
	float: right;
	clear: both;
	margin: 2em;
}

/* Lists */

li, dd 
{
  text-align: justify
}

dt {
	font-style: normal; 
	margin-top: 1em
}
dd {
	font-style: normal; 
	margin-left: 4em
}

dd.sdd {
	margin-left: 5em
}

dd ul {margin-top: 0}
li dl {margin-top: 0}
ul {list-style-type: square}
ul ul {list-style-type: disc}
ul ul ul {list-style-type: circle}

/* Addresses */

address {
	margin-top: 1ex; margin-bottom: 1ex
}
address.poste {
	font-style: italic
}
address.email {
	font-style: normal
}
address.phone {
	font-style: oblic
}

/* Links */

a:link, a:visited {
	color: darkred;
	text-decoration: none;
	border-bottom-width: 1px;
	border-bottom-style: dotted;
	border-bottom-color:  red;
	padding-bottom: 0px
}

a:hover, a:active {
	color: red; 
	text-decoration: none;
	border-bottom-color: black;
	border-bottom-style: solid
}

--></style>
</head>
<body>
<div class="node">
<p>
<a name="Data-components-mapping"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="Subprogram-components-mapping.html#Subprogram-components-mapping">Subprogram components mapping</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Components-mapping-rules.html#Components-mapping-rules">Components mapping rules</a>
<hr>
</div>

<h4 class="subsection">A.1.1 Data components mapping</h4>

<h5 class="subsubsection">A.1.1.1 Base type mapping</h5>

<p>A subcomponent-free <code>data</code> component should contain a
<code>ARAO::data_type</code> property in order to generate the corresponding
Ada type. ARAO predefined types are : <code>integer</code>, <code>float</code>,
<code>null</code>, <code>string</code> and <code>boolean</code>. Normal data components are
mapped to the related Ada type, as seen in the following AADL example
:

<pre class="smallexample">     
     <b>data</b> message
     <b>properties</b>
       ARAO::data_type =&gt; <b>in</b>teger;
     <b>end</b> message;
     
</pre>
   <p>is mapped to the following Ada95 code:

<pre class="smallexample">     
     <b>type</b> message <b>is</b> <b>new</b> Integer;
     
</pre>
   <h5 class="subsubsection">A.1.1.2 Composed type mapping</h5>

<p>AADL <code>data</code> component implementations may contain others <code>data</code>
subcomponents. In this case, the <code>data</code> component is mapped to an
Ada record type.

   <p>As an example, the following AADL component implementation:

<pre class="smallexample">     
     <b>data</b> <b>in</b>teger_type
     <b>properties</b>
       ARAO::data_type =&gt; <b>in</b>teger;
     <b>end</b> <b>in</b>teger_type;
     
     <b>data</b> structure
     <b>end</b> structure;
     
     <b>data</b> <b>implementation</b> structure.impl
     <b>subcomponents</b>
       d1 : <b>data</b> <b>in</b>teger_type;
       d2 : <b>data</b> <b>in</b>teger_type;
     <b>end</b> structure.impl;
     
</pre>
   <p>is mapped to the following Ada code :

<pre class="smallexample">     
     <b>type</b> Integer_Type <b>is</b> <b>new</b> Integer;
     
     <b>type</b> Structure_Impl <b>is</b>
        <b>record</b>
       D1 : Integer_Type;
       D2 : Integer_Type;
        <b>end</b> <b>record</b>;
     
</pre>
   <h5 class="subsubsection">A.1.1.3 Protected type mapping</h5>

<p>AADL protected <code>data</code> components must be declared in the same way
composed types are, i.e. by encapsulating them within another AADL type
declaration.

   <p>For each protected <code>data</code> components, a new type is declared which
contains all data components (i.e. fields of the related composed type)
plus a mutex object within a Ada record. As for composed types, all
fields must be either a previously user-declared type or a ARAO base
type. Accessors and building features for the type will be declared
too, as for the data-owned procedures (&ldquo;methods&rdquo;) designated in the
<code>features</code> part of the <code>data</code> component.

   <p>The generated code enforces access protection, and declare type's
object-oriented procedures (&ldquo;methods&rdquo;, as defined by user), using
the middleware mutexes. A &ldquo;method&rdquo; of a type must always has as
<code>features</code> a <code>requires data access</code> on this data.

   <p>For example, the following AADL declaration :

<pre class="smallexample">     
     <b>data</b> <b>in</b>ternal_message
     <b>properties</b>
       ARAO::data_type =&gt; <b>in</b>teger;
     <b>end</b> <b>in</b>ternal_message;
     
     <b>data</b> message
     <b>subcomponents</b>
       Field : <b>data</b> <b>in</b>ternal_message;
     <b>features</b>
       method : <b>subprogram</b> update;
     <b>properties</b>
       ARAO::Access_Control_Protocol =&gt; Protected_Access;
     <b>end</b> message;
     
</pre>
   <p>would generate a code like this :

<pre class="smallexample">     
     <b>package</b> Partition <b>is</b>
     
        <b>type</b> Message <b>is</b> <b>private</b>;
     
        <b>procedure</b> Build
          (This : <b>out</b> Message);
     
        <b>procedure</b> Get_Data
          (This  : <b>in</b> Message;
           Value : <b>out</b> Internal_Message);
     
        <b>procedure</b> Set_Data
          (This  : <b>in</b> <b>out</b> Message;
           Value : <b>in</b> Internal_Message);
     
     <b>private</b>
     
        <b>type</b> Message <b>is</b>
           <b>record</b>
              Data  : Partition.Internal_Message;
              Mutex : PolyORB.Tasking.Mutexes.Mutex_Access;
           <b>end</b> <b>record</b>;
     
     <b>end</b> Partition;
     
</pre>
   <p>and the <code>update</code> method which will be call by generated code is like this :

<pre class="smallexample">     
     <b>procedure</b> Update
       (This  : <b>in</b> <b>out</b> Message;
        Value : <b>in</b> Partition.Internal_Message) <b>is</b>
     <b>begin</b>
        PolyORB.Tasking.Mutexes.Enter (This.Mutex);
        Repository.Update (This, Value);
        PolyORB.Tasking.Mutexes.Leave (This.Mutex);
     <b>end</b> Update;
     
</pre>
   <p>Where the procedures <code>Enter</code> and <code>Leave</code> are middleware mutexes'
<code>take</code> and <code>release</code> procedures.

   <p>We define <i>protected data type internal type</i> as the components
(usually only one) , excluding the mutex, which are embedded in a
protected type as a <code>subcomponent</code>. The <i>protected data type
internal type</i> could be either a protected type or a &ldquo;normal&rdquo;
(non-protected) type. Eventually, all protected types can be
decomposed in a set of basic types.

<h5 class="subsubsection">A.1.1.4 Accessor usage</h5>

<p>Data accessors can be used by the user exactly as data-owned procedure
are. In the current version, they are the only ones actually called by
the PolyORB AADL runtime, contrary to the generated interfaces which
are not called at all.

   <p>Protected type accessors include <code>Set_X</code> and <code>Get_X</code> Ada
procedures, where <code>X</code> is the name of the Field which contains the
real (internal) data type. Those procedures are access-protected,
using the protected object's middleware mutex to ensure mutual
exclusion. The <code>Build</code> procedure will ensure mutex
initialization.

   <p>An example of safe usage of accessors is :

<pre class="smallexample">     
     -----------------------
     -- <i>Concurrent_Update --</i>
     -----------------------
     
     <b>procedure</b> Concurrent_Update (arg : <b>in</b> <b>out</b> Partition.Counter_Type)
     <b>is</b>
        Sum  : Partition.Integer_Type;
     <b>begin</b>
        -- <i> data initialization</i>
        Partition.Set_Field (Data, 0);
     
        <b>for</b> I <b>in</b> 0 .. 100 <b>loop</b>
           Partition.Increment (Data);
           Partition.Get_Field (Data, Sum);
           <b>if</b> Integer (Sum) = 100 <b>then</b>
              <b>exit</b>;
           <b>end</b> <b>if</b>;
        <b>end</b> <b>loop</b>;
     <b>end</b> Concurrent_Update;
     
</pre>
   <p>relying on the following AADL declarations :

<pre class="smallexample">     
     <b>data</b> Integer_Type
     <b>properties</b>
       ARAO::data_type =&gt; <b>in</b>teger;
     <b>end</b> Integer_Type;
     
     <b>data</b> Counter_Type
     <b>features</b>
       Increment : <b>subprogram</b> Increment;
     <b>subcomponents</b>
       field : <b>data</b> Integer_Type;
     <b>properties</b>
       Concurency_Control_Protocol =&gt; Protected_Access;
     <b>end</b> Counter_Type;
     
     <b>subprogram</b> Increment
     <b>features</b>
       this : <b>requires</b> <b>data</b> <b>access</b> Counter_Type;
     <b>properties</b>
       <b>source</b>_language =&gt; Ada95;
       <b>source</b>_name =&gt; "<i>Repository</i>";
     <b>end</b> Increment;
     
     <b>subprogram</b> Concurrent_Update
     <b>features</b>
       arg : <b>requires</b> <b>data</b> <b>access</b> Counter_Type;
     <b>properties</b>
       <b>source</b>_language =&gt; Ada95;
       <b>source</b>_name =&gt; "<i>Repository</i>";
     <b>end</b> Concurrent_Update;
     
     <b>thread</b> Task
     <b>features</b>
       sh_data : <b>requires</b> <b>data</b> <b>access</b> Counter_Type;
     <b>properties</b>
       Dispatch_Protocol =&gt; Periodic;
       Period =&gt; 1000 Ms;
     <b>end</b> Task;
     
     <b>thread</b> <b>implementation</b> Task.impl
     <b>calls</b> {
       sp1 : <b>subprogram</b> Concurrent_Update;
     };
     <b>connections</b>
       Cnx_Th_dat : <b>data</b> <b>access</b> sh_data -&gt; sp1.arg;
     <b>end</b> Task.impl;
     
     <b>process</b> <b>implementation</b> global.impl
     <b>subcomponents</b>
       th1 : <b>thread</b> Task.impl;
       th2 : <b>thread</b> Task.impl;
       dat : <b>data</b> Counter_Type;
     <b>connections</b>
       Cnx_1 : <b>data</b> <b>access</b> dat -&gt; th1.sh_data;
       Cnx_2 : <b>data</b> <b>access</b> dat -&gt; th2.sh_data;
     <b>end</b> global.impl;
</pre>
   <p>with the following package specification and body generated :

<pre class="smallexample">     
     <b>package</b> Partition <b>is</b>
     
        <b>type</b> Integer_Type <b>is</b> <b>new</b> Integer;
        <b>type</b> Counter_Type <b>is</b> <b>private</b>;
     
        <b>procedure</b> Build
          (This : <b>out</b> Partition.Integer_Type);
     
        <b>procedure</b> Get_Field
          (This  : <b>in</b> Message;
           Value : <b>out</b> Partition.Integer_Type);
     
        <b>procedure</b> Set_Field
          (This  : <b>in</b> <b>out</b> Message;
           Value : <b>in</b> Partition.Integer_Type);
     
        <b>procedure</b> Increment
          (This : <b>in</b> <b>out</b> Counter_Type);
     
     <b>private</b>
        <b>type</b> Counter_Type <b>is</b>
           <b>record</b>
              Field : Partition.Integer_Type;
              Mutex : PolyORB.Tasking.Mutexes.Mutex_Access;
           <b>end</b> <b>record</b>;
     
     <b>end</b> Partition;
     
</pre>
   <pre class="smallexample">     
     <b>with</b> Repository;
     
     <b>package</b> <b>body</b> Counter_Type_PKG <b>is</b>
     
        -----------
        -- <i>Build --</i>
        -----------
     
        <b>procedure</b> Build
          (This : <b>out</b> Message)
        <b>is</b>
        <b>begin</b>
           -- <i> Initialize the middleware's mutex</i>
           PolyORB.Tasking.Mutexes.Create (T.Mutex);
        <b>end</b> Build;
     
        ---------------
        -- <i>Get_Field --</i>
        ---------------
     
        <b>procedure</b> Get_Field
          (This  : <b>in</b> Counter_Type;
           Value : <b>out</b> Partition.Integer_Type)
        <b>is</b>
        <b>begin</b>
           PolyORB.Tasking.Mutexes.Enter (T.Mutex);
           Value := This.Field;
           PolyORB.Tasking.Mutexes.Leave (T.Mutex);
        <b>end</b> Get_Field;
     
        ---------------
        -- <i>Set_Field --</i>
        ---------------
     
        <b>procedure</b> Set_Field
          (This  : <b>in</b> <b>out</b> Counter_Type;
           Value : <b>in</b> Partition.Integer_Type)
        <b>is</b>
        <b>begin</b>
           PolyORB.Tasking.Mutexes.Enter (T.Mutex);
           This.Field := Value;
           PolyORB.Tasking.Mutexes.Leave (T.Mutex);
        <b>end</b> Set_Field;
     
        ---------------
        -- <i>Increment --</i>
        ---------------
     
        <b>procedure</b> Increment
          (This : <b>in</b> <b>out</b> Counter_Type)
        <b>is</b>
        <b>begin</b>
           PolyORB.Tasking.Mutexes.Enter (This.Mutex);
           Repository.Increment (This.Field);
           PolyORB.Tasking.Mutexes.Leave (This.Mutex);
        <b>end</b> Increment;
     
     <b>end</b> Counter_Type_PKG;
     
</pre>
   <p>Note that the <code>Set</code> usage could had been replaced by an
<code>Initialization</code> method of Counter_Type, and that the <code>Get</code> could
had been replaced by a <code>Test_Value</code> method.

<h5 class="subsubsection">A.1.1.5 Middleware mapping</h5>

<p>We have seen that in the translation phase, the AADL data components
are mapped to Ada95 types. Since the communication between nodes is
performed using the PolyORB tools, all data sent in a request must
have the neutral type <code>PolyORB.Any.Any</code>. So, conversion functions
from and to this neutral type must be generated. For a process named
<code>proc</code> these conversion functions will be generated in the
<code>proc_Helpers</code> package. Example:

<pre class="smallexample">     
     <b>data</b> message
     <b>properties</b>
       ARAO::data_type =&gt; <b>in</b>teger;
     <b>end</b> message;
     
</pre>
   <p>is a definition for an integer type, the conversion routines generated
in <code>proc_Helpers</code> are:

<pre class="smallexample">     
     <b>with</b> Partition;
     <b>with</b> PolyORB.Any;
     
     <b>package</b> proc_helpers <b>is</b>
        -- <i> TypeCode variable used to characterize an Any variable</i>
     
        TC_message : PolyORB.Any.TypeCode.Object :=
           PolyORB.Any.TypeCode.TC_Alias;
     
        <b>function</b> From_Any (Item : <b>in</b> PolyORB.Any.Any) <b>return</b> Partition.message;
     
        <b>function</b> To_Any (Item : <b>in</b> Partition.message) <b>return</b> PolyORB.Any.Any;
     
     <b>end</b> proc_helpers;
     
</pre>
   <p>Note that we use the <code>Namespaces</code> package created in the translation
phase.

<h5 class="subsubsection">A.1.1.6 AADL Properties support</h5>

<p>Available properties for data components can be found in SAE AS5506,
in 5.1 page 50 and in Appendix A, pages 197-218.

   <p><table summary=""><tr align="left"><td valign="top" width="40%">Concurency_control_protocol
</td><td valign="top" width="60%">Supported : None, Access_Protected
<br></td></tr><tr align="left"><td valign="top" width="40%">Not_Collocated
</td><td valign="top" width="60%">Not Supported
<br></td></tr><tr align="left"><td valign="top" width="40%">Provided_Access
</td><td valign="top" width="60%">Not Supported
<br></td></tr><tr align="left"><td valign="top" width="40%">Required_Access
</td><td valign="top" width="60%">Not Supported
<br></td></tr><tr align="left"><td valign="top" width="40%">Source_Code_Size
</td><td valign="top" width="60%">Not Supported
<br></td></tr><tr align="left"><td valign="top" width="40%">Source_Language
</td><td valign="top" width="60%">Not Supported
<br></td></tr><tr align="left"><td valign="top" width="40%">Source_Name
</td><td valign="top" width="60%">Not Supported
<br></td></tr><tr align="left"><td valign="top" width="40%">Source_Text
</td><td valign="top" width="60%">Not Supported
<br></td></tr><tr align="left"><td valign="top" width="40%">Type_Source_Name
</td><td valign="top" width="60%">Not Supported
   <br></td></tr></table>

   </body></html>

